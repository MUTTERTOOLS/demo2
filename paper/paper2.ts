import CanvasKitInit from "canvaskit-wasm";

const CanvasKitPromise = CanvasKitInit({
  locateFile: file => `/${file}`
})

const test1 = ' M60.15237363958545,33.835710172266815  A707.469193092659,707.469193092659 0 0,1 81.76963291631147,27.27739559318531  A707.469193092659,707.469193092659 0 0,1 103.38689219303748,21.462573837132126  A707.469193092659,707.469193092659 0 0,1 125.00415146976351,16.372477616485252  A707.469193092659,707.469193092659 0 0,1 146.62141074648952,11.991194285911037  A707.469193092659,707.469193092659 0 0,1 168.23867002321555,8.305398471364205  A707.469193092659,707.469193092659 0 0,1 189.85592929994158,5.304137854944323  A707.469193092659,707.469193092659 0 0,1 211.47318857666758,2.9786636407413294  A707.469193092659,707.469193092659 0 0,1 233.0904478533936,1.3222993229354616  A707.469193092659,707.469193092659 0 0,1 254.70770713011964,0.33034302391840553  A707.469193092659,707.469193092659 0 0,1 276.32496640684565,0  A707.469193092659,707.469193092659 0 0,1 297.9422256835717,0.33034302391840553  A707.469193092659,707.469193092659 0 0,1 319.5594849602977,1.3222993229354616  A707.469193092659,707.469193092659 0 0,1 341.17674423702374,2.9786636407413294  A707.469193092659,707.469193092659 0 0,1 362.7940035137497,5.304137854944323  A707.469193092659,707.469193092659 0 0,1 384.41126279047575,8.305398471364205  A707.469193092659,707.469193092659 0 0,1 406.0285220672018,11.991194285911037  A707.469193092659,707.469193092659 0 0,1 427.6457813439278,16.372477616485252  A707.469193092659,707.469193092659 0 0,1 449.26304062065384,21.462573837132126  A707.469193092659,707.469193092659 0 0,1 470.8802998973798,27.27739559318531  A707.469193092659,707.469193092659 0 0,1 492.49755917410585,33.835710172266815  L661.6761100354399,33.835710172266815  A707.469193092659,707.469193092659 0 0,1 683.293369312166,27.27739559318531  A707.469193092659,707.469193092659 0 0,1 704.910628588892,21.462573837132126  A707.469193092659,707.469193092659 0 0,1 726.527887865618,16.372477616485252  A707.469193092659,707.469193092659 0 0,1 748.1451471423441,11.991194285911037  A707.469193092659,707.469193092659 0 0,1 769.7624064190701,8.305398471364205  A707.469193092659,707.469193092659 0 0,1 791.379665695796,5.304137854944323  A707.469193092659,707.469193092659 0 0,1 812.996924972522,2.9786636407413294  A707.469193092659,707.469193092659 0 0,1 834.6141842492481,1.3222993229354616  A707.469193092659,707.469193092659 0 0,1 856.2314435259741,0.33034302391840553  A707.469193092659,707.469193092659 0 0,1 877.8487028027001,0  A707.469193092659,707.469193092659 0 0,1 899.4659620794262,0.33034302391840553  A707.469193092659,707.469193092659 0 0,1 921.0832213561522,1.3222993229354616  A707.469193092659,707.469193092659 0 0,1 942.7004806328782,2.9786636407413294  A707.469193092659,707.469193092659 0 0,1 964.3177399096043,5.304137854944323  A707.469193092659,707.469193092659 0 0,1 985.9349991863303,8.305398471364205  A707.469193092659,707.469193092659 0 0,1 1007.5522584630562,11.991194285911037  A707.469193092659,707.469193092659 0 0,1 1029.1695177397823,16.372477616485252  A707.469193092659,707.469193092659 0 0,1 1050.7867770165083,21.462573837132126  A707.469193092659,707.469193092659 0 0,1 1072.4040362932344,27.27739559318531  A707.469193092659,707.469193092659 0 0,1 1094.0212955699603,33.835710172266815  L1261.3200847550575,33.835710172266815  L1261.3200847550575,169.1785508613341  L1176.7308093243903,253.7678262920011  L1126.313083305858,253.7678262920011  L1095.52510491095,169.1785508613341  A1.8797616762370453,1.8797616762370453 0 0,0 1094.0212955699603,168.42664619083925  A1.8797616762370453,1.8797616762370453 0 0,0 1092.5174862289707,169.1785508613341  L1076.5671794895893,185.12885760071575  L1077.23177560373,185.79345371485664  L1086.5022488650122,195.0639269761389  L1086.5022488650122,289.483298140505  A15.038093409896362,15.038093409896362 0 0,1 1071.4641554551158,304.52139155040135  L1060.010968284986,304.52139155040135  L1009.2574030265856,253.7678262920011  L877.8487028027002,253.7678262920011  L877.8487028027002,263.05109049957144  A15.038093409896362,15.038093409896362 0 0,1 873.4441472190583,273.6846283258259  L842.6073839944829,304.5213915504013  L675.0208836261181,304.5213915504013  L663.1799193764296,169.17855086133403  A1.8797616762370453,1.8797616762370453 0 0,0 661.67611003544,168.42664619083925  A1.8797616762370453,1.8797616762370453 0 0,0 660.1723006944503,169.1785508613341  L576.3349299342781,253.7678262920011  L524.7893469100037,253.7678262920011  L494.0013685150955,169.1785508613341  A1.8797616762370453,1.8797616762370453 0 0,0 492.49755917410573,168.42664619083925  A1.8797616762370453,1.8797616762370453 0 0,0 490.9937498331162,169.1785508613341  L475.0434430937345,185.12885760071575  L475.7080392078754,185.79345371485664  L484.9785124691577,195.0639269761389  L484.9785124691577,289.483298140505  A15.038093409896362,15.038093409896362 0 0,1 469.94041905926133,304.52139155040135  L458.4872318891312,304.52139155040135  L407.73366663073097,253.7678262920011  L276.32496640684565,253.7678262920011  L276.32496640684565,263.05109049957144  A15.038093409896362,15.038093409896362 0 0,1 271.9204108232037,273.6846283258259  L241.08364759862835,304.5213915504013  L73.49714723026362,304.5213915504013  L61.65618298057508,169.17855086133403  A1.8797616762370453,1.8797616762370453 0 0,0 60.15237363958541,168.42664619083925  L0,108.2742725512538  L0,49.95349011180889  L60.15237363958545,33.835710172266815  Z '

const test = test1;

async function getBleedLines(pathStr: string, offset: number = 5) {
  const CanvasKit = await CanvasKitPromise;
  const path = CanvasKit.Path.MakeFromSVGString(pathStr);
  if(path === null){
    throw new Error("pathStr is error!");
  }
  const strongPath = path.copy().stroke({
    width: offset * 2,
    join: CanvasKit.StrokeJoin.Miter,
    cap: CanvasKit.StrokeCap.Butt,
  });

  if(strongPath === null) {
    throw new Error("pathStr is error!")
  }

  strongPath.op(path, CanvasKit.PathOp.Union);

  const SVGString = strongPath.toSVGString();

  path.delete();
  strongPath.delete();

  return SVGString;
}

const svg = document.createElementNS("http://www.w3.org/2000/svg",'svg')
const path1 = document.createElementNS("http://www.w3.org/2000/svg", "path");
const path2 = document.createElementNS("http://www.w3.org/2000/svg", "path");
const g = document.createElementNS("http://www.w3.org/2000/svg", "g");

path1.setAttribute('d', test)
path1.setAttribute("stroke", "green");
path1.setAttribute("stroke-width", "1");
path2.setAttribute('d', await getBleedLines(test, 16))
path2.setAttribute("stroke", "green");
path2.setAttribute("stroke-width", "1");

g.setAttribute("transform", "translate(100,100)");
svg.setAttribute("style", "width: 100vw; height: 100vh");

svg.append(g)
g.append(path2, path1)
document.body.append(svg)